require("./config/config.js");

requestHandler = function (request, response) {
    var list = request.url.replace('/', '');
    response.setHeader('Access-Control-Allow-Origin', 'http://localhost:8001');
    response.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');
    response.setHeader('Access-Control-Allow-Headers','Authorization');;
    switch (request.method) {
        case 'GET':
            console.log('called2');
            REDISCLIENT.lrange(list, 0, 100, function (err, info) {
                console.log('called');
                response.end(JSON.stringify(info));
            });
            break;
        case 'DELETE':
            REDISCLIENT.del("fatal", function (err, info) {
               
                response.end();
            });
            break;
        case 'OPTIONS':
                response.end();
            break;
    }

};


const server = http.createServer(requestHandler);
server.listen(port, function (err) {
    if (err) {
        return console.log('something bad happened', err)
    } else {
        console.log('server is listening on ' + port)
    }
})